#include <iostream>
#include <string>
using namespace std;

class StackStr {
public:
    string s[50];
    int top;

    StackStr() { top = -1; }

    void push(string x) {
        s[++top] = x;
    }

    string pop() {
        if (top == -1) return "";
        return s[top--];
    }
};

class StackChar {
public:
    char s[50];
    int top;

    StackChar() { top = -1; }

    void push(char x) {
        s[++top] = x;
    }

    char pop() {
        if (top == -1) return '\0';
        return s[top--];
    }

    char peek() {
        if (top == -1) return '\0';
        return s[top];
    }

    bool empty() {
        return top == -1;
    }
};

int prec(char c) {
    if (c == '+' || c == '-') return 1;
    if (c == '*' || c == '/') return 2;
    return -1;
}


void prefixToInfix() {
    StackStr st;
    string pre;
    cout << "Enter Prefix: ";
    cin >> pre;

    for (int i = pre.length() - 1; i >= 0; i--) {
        char ch = pre[i];

        if (isalnum(ch)) {
            st.push(string(1, ch));
        } 
        else {
            string a = st.pop();
            string b = st.pop();
            string result = "(" + a + ch + b + ")";
            st.push(result);
        }
    }

    cout << "Infix = " << st.pop() << endl;
}


void infixToPostfix() {
    StackChar st;
    string infix, postfix = "";
    cout << "Enter Infix: ";
    cin >> infix;

    for (char ch : infix) {
        if (isalnum(ch)) {
            postfix += ch;
        }
        else if (ch == '(') {
            st.push(ch);
        }
        else if (ch == ')') {
            while (!st.empty() && st.peek() != '(') {
                postfix += st.pop();
            }
            st.pop();
        }
        else {
            while (!st.empty() && prec(st.peek()) >= prec(ch)) {
                postfix += st.pop();
            }
            st.push(ch);
        }
    }

    while (!st.empty()) {
        postfix += st.pop();
    }

    cout << "Postfix = " << postfix << endl;
}


void evaluatePostfix() {
    StackStr st;
    string post;
    cout << "Enter Postfix: ";
    cin >> post;

    for (char ch : post) {
        if (isdigit(ch)) {
            st.push(string(1, ch));
        }
        else {
            int b = stoi(st.pop());
            int a = stoi(st.pop());
            int r = 0;

            if (ch == '+') r = a + b;
            else if (ch == '-') r = a - b;
            else if (ch == '*') r = a * b;
            else if (ch == '/') r = a / b;

            st.push(to_string(r));
        }
    }

    cout << "Result = " << st.pop() << endl;
}


int main() {
    int ch;

    do {
        cout << "\n1) Prefix â†’ Infix\n";
        cout << "2) Infix â†’ Postfix\n";
        cout << "3) Postfix Evaluation\n";
        cout << "4) Exit\n";
        cout << "Enter choice: ";
        cin >> ch;

        if (ch == 1) prefixToInfix();
        else if (ch == 2) infixToPostfix();
        else if (ch == 3) evaluatePostfix();
    }
    while (ch != 4);

    return 0;
}